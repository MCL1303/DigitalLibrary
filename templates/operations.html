<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Взять/Вернуть книги</title>
    <link href="/static/css/bootstrap.css" rel="stylesheet">
    <link href="/static/css/navbar.css" rel="stylesheet">
    <script src="/static/js/jquery.js"></script>
    <script src="/static/js/bootstrap.js"></script>
    <link rel="icon" type="image/ico" href="/static/images/favicon.ico">
</head>
<body>
    <div class="row">
        <div class="content" style="text-align: center;">
            <h2>Отсканируйте штрих код книги и приложите карту к сканеру, чтобы взять или вернуть её</h2>
            <img id="cover" src="" alt="" class="img-thumbnail", style="width: 370px; height: 500px; margin-top: 30px;">
            <h2 id="status">Статус операции</h2>
        </div>
        <div style="text-align: center;">
            <div class="alert alert-info alert-dismissible fade" style="margin: 0px 20px 0px 20px;" id="alert_invite">
                <h4>Ура, новый пользователь</h4>
                <p>Ваш пригласительный код</p>
                <h3 id="inviteCode">ФЫВФЫВ</h3>
                <p>Запишите его и никому не показывайте. Приложите карточку повторно для того, чтобы скрыть это сообщение</p>
            </div>
        </div>
        <script>
            var last_new_user = "", current_user = ""
            function book(barcode) {
                if(current_user != "") {
                    $.post(
                        "http://localhost:1303/api/book/action",
                        {user: current_user, book: barcode},
                        function(data) {
                            if(data.action == "Fail") {
                                $("#status").text("Книга не найдена");
                                return;
                            }
                            $("#cover").attr(
                                'src',
                                "http://localhost:1303/static/images/book/large-covers/" +
                                    data.book.barcode + ".jpg"
                            );
                            if (data.action == "Take") {
                                $("#status").text("Вы взяли книгу");
                            } else {
                                $("#status").text("Вы вернули книгу");
                            }
                        },
                        "json"
                    )
                    current_user = ""
                }
            }
            function user(user) {
                $.post(
                    "http://localhost:1303/api/user/add",
                    {user: user},
                    function(data) {
                        if (data.answer == "Done") {
                            $("#inviteCode")[0].innerHTML = data.code;
                            $("#alert_invite").addClass("in");
                            last_new_user = user;
                            current_user = "";
                        } else {
                          $("#alert_invite").removeClass("in");
                          if(user == last_new_user){
                            last_new_user = "";
                          } else {
                            current_user = user;
                          }

                        }
                    },
                    "json"
                )
            }
        </script>
    </div>
</body>